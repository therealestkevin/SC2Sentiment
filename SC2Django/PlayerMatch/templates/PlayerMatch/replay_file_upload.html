{% extends 'base.html' %}
{% load crispy_forms_filters %}
{% load crispy_forms_tags %}

{% block content %}

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
            integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
            crossorigin="anonymous"></script>

    <!-- JS, Popper.js, and jQuery -->


    <style>
        .ButtonDiv {
            text-align: center;
        }

        .inline-block {
            display: inline-block;
        }

        .hvr-grow-card-green {
            max-width: 32vw;
            height: 18vw;
            object-fit: contain;
            -webkit-filter: none;
            animation: glowGreen 0.5s alternate;
            animation-iteration-count: 2;
            transition: ease-in-out;
            transition-duration: 0.3s;
            transition-property: transform;
        }

        .hvr-grow-card-red {
            max-width: 32vw;
            height: 18vw;
            object-fit: contain;
            -webkit-filter: none;
            animation: glowRed 0.5s alternate;
            animation-iteration-count: 2;
            transition: ease-in-out;
            transition-duration: 0.3s;
            transition-property: transform;
        }

        .hvr-grow-card-green:hover {
            filter: drop-shadow(0px 0px 15px blue);
            transform: scale(1.1);

        }

        .hvr-grow-card-red:hover {
            filter: drop-shadow(0px 0px 15px blue);
            transform: scale(1.1);

        }


        /*-webkit-filter: drop-shadow(12px 12px -10px #aef4af);*/
        @keyframes glowGreen {
            from {
                -webkit-filter: drop-shadow(0px 0px -15px #068f0f);
                filter: drop-shadow(0px 0px -15px #068f0f);
            }
            to {
                -webkit-filter: drop-shadow(0px 0px 15px #068f0f);
                filter: drop-shadow(0px 0px 15px #068f0f);
            }
        }

        @keyframes glowRed {
            from {
                -webkit-filter: drop-shadow(0px 0px -15px #fa0905);
                filter: drop-shadow(0px 0px -15px #fa0905);
            }
            to {
                -webkit-filter: drop-shadow(0px 0px 15px #fa0905);
                filter: drop-shadow(0px 0px 15px #fa0905);
            }
        }

        @keyframes glowBlue {
            from {
                -webkit-filter: drop-shadow(0px 0px -15px #041cba);
                filter: drop-shadow(0px 0px -15px #041cba);
            }
            to {
                -webkit-filter: drop-shadow(0px 0px 15px #041cba);
                filter: drop-shadow(0px 0px 15px #041cba);
            }
        }

        .fadeUpArrow {
            width: 32vw;
            height: 3vw;
            object-fit: scale-down;
            filter: invert(59%) sepia(47%) saturate(631%) hue-rotate(63deg) brightness(93%) contrast(88%);
            animation: fadeOut ease 1s;
            animation-play-state: paused;
            animation-fill-mode: forwards;
            -webkit-animation: fadeOut ease 1s;
            -webkit-animation-fill-mode: forwards;
            -moz-animation: fadeOut ease 1s;
            -moz-animation-fill-mode: forwards;
            -o-animation: fadeOut ease 1s;
            -o-animation-fill-mode: forwards;
        }

        .fadeDownArrow {
            width: 32vw;
            height: 3vw;
            object-fit: scale-down;
            filter: invert(32%) sepia(35%) saturate(2084%) hue-rotate(327deg) brightness(91%) contrast(88%);
            animation: fadeOut ease 1s;
            animation-play-state: paused;
            animation-fill-mode: forwards;
            -webkit-animation: fadeOut ease 1s;
            -webkit-animation-fill-mode: forwards;
            -moz-animation: fadeOut ease 1s;
            -moz-animation-fill-mode: forwards;
            -o-animation: fadeOut ease 1s;
            -o-animation-fill-mode: forwards;
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.5);
            }
        }

        @-moz-keyframes fadeOut {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.5);
            }
        }

        @-webkit-keyframes fadeOut {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.5);
            }
        }

        @-o-keyframes fadeOut {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.5);
            }
        }


    </style>



    <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
        <h1 class="display-4">Starcraft 2 Sentiment</h1>
        <p class="lead">
            Determining the angriest and friendliest players in Starcraft through mass sentiment analysis of replay
            in-game messages.
        </p>
    </div>
    &nbsp;&nbsp;
    <div class="card-deck mb-3 text-center " style="width: 90vw;margin-left: 5vw">
        <div class="card mb-4 shadow-sm d-flex ">
            <div class="card-header">
                <h4 class="card-title pricing-card-title">Terran</h4>
            </div>
            <div class="card-body">
                {% load static %}
                <img id="terranIcon" class="hvr-grow-card-green" src="{% static "images/terran.png" %}" alt="Terran"
                     style="animation-play-state: paused">
            </div>
            <div class="card-footer">
                <div class="container">
                    <div class="row justify-content-center" style="align-items: center">
                        <div class="col-3">
                            {% load static %}
                            <img id="terranSalt" src="{% static "images/salt.gif" %}" alt="salt"
                                 style="width:100%; visibility: hidden">

                            <!--{% if terran < protoss and terran < zerg %}
                                {% load static %}
                                <img src="{% static "images/salt.gif" %}" alt="salt"
                                     style="width:100%">
                            {% endif %}-->

                        </div>
                        <div class="col-6">
                            <h1 id="terranSent" class="display-4 font-weight-bold text-center">{{ terran }}</h1>
                        </div>
                        <div class="col-3">
                            <div class="col">
                                {% load static %}
                                <img id="terranUpArrow" class="fadeUpArrow" src="{% static "images/upwardsArrow.png" %}"
                                     alt="upArrow"
                                     style="width:100%; animation-play-state: paused; visibility: hidden">
                            </div>
                            <div class="col">
                                {% load static %}
                                <img id="terranDownArrow" class="fadeDownArrow"
                                     src="{% static "images/downwardsArrow.png" %}"
                                     alt="downArrow"
                                     style="width:100%; animation-play-state: paused; visibility: hidden">
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-4 shadow-sm">
            <div class="card-header">
                <h4 class="card-title pricing-card-title">Zerg</h4>
            </div>
            <div class="card-body">
                {% load static %}
                <img id="zergIcon" class="hvr-grow-card-green" src="{% static "images/zerg.png" %}" alt="Zerg"
                     style="animation-play-state: paused">
            </div>
            <div class="card-footer">
                <div class="container">
                    <div class="row" style="align-items: center">
                        <div class="col-3">
                            {% load static %}
                            <img id="zergSalt" src="{% static "images/salt.gif" %}" alt="salt"
                                 style="width:100%; visibility: hidden">

                            <!--{% if zerg < terran and zerg < protoss %}
                                {% load static %}
                                <img src="{% static "images/salt.gif" %}" alt="salt"
                                     style="width:100%">
                            {% endif %}-->

                        </div>
                        <div class="col-6">
                            <h1 id="zergSent" class="display-4 font-weight-bold text-center">{{ zerg }}</h1>
                        </div>
                        <div class="col-3">
                            <div class="col">
                                {% load static %}
                                <img id="zergUpArrow" class="fadeUpArrow" src="{% static "images/upwardsArrow.png" %}"
                                     alt="upArrow"
                                     style="width:100%; animation-play-state: paused; visibility: hidden">
                            </div>
                            <div class="col">
                                {% load static %}
                                <img id="zergDownArrow" class="fadeDownArrow"
                                     src="{% static "images/downwardsArrow.png" %}"
                                     alt="downArrow"
                                     style="width:100%; animation-play-state: paused; visibility: hidden">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-4 shadow-sm">
            <div class="card-header">
                <h4 class="card-title pricing-card-title">Protoss</h4>
            </div>
            <div class="card-body">
                {% load static %}
                <img id="protossIcon" class="hvr-grow-card-green" src="{% static "images/protoss.png" %}" alt="Protoss"
                     style="animation-play-state: paused">
            </div>
            <div class="card-footer">
                <div class="container">
                    <div class="row" style="align-items: center">
                        <div class="col-3">

                            {% load static %}
                            <img id="protossSalt" src="{% static "images/salt.gif" %}" alt="salt"
                                 style="width:100%; visibility: hidden">

                            <!--{% if protoss < terran and protoss < zerg %}
                                {% load static %}
                                <img src="{% static "images/salt.gif" %}" alt="salt"
                                     style="width:100%">
                            {% endif %}-->

                        </div>
                        <div class="col-6">
                            <h1 id="protossSent" class="display-4 font-weight-bold text-center">{{ protoss }}</h1>
                        </div>
                        <div class="col-3">
                            <div class="col">
                                {% load static %}
                                <img id="protossUpArrow" class="fadeUpArrow"
                                     src="{% static "images/upwardsArrow.png" %}" alt="upArrow"
                                     style="width:100%; animation-play-state: paused; visibility: hidden">
                            </div>
                            <div class="col">
                                {% load static %}
                                <img id="protossDownArrow" class="fadeDownArrow"
                                     src="{% static "images/downwardsArrow.png" %}"
                                     alt="downArrow"
                                     style="width:100%; animation-play-state: paused; visibility: hidden">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="text-center" style="padding-bottom: 2vw">
        <p class="h4">
            Lower numbers indicate negative attitudes while higher numbers indicate positive attitudes
        </p>
    </div>

    <div class="bg-white border-bottom shadow-sm " style=" box-shadow: 0 4px 2px -2px gray;">
        <h3 class="my-0 mr-md-auto font-weight-bold">&nbsp;&nbsp;&nbsp;&nbsp;Recent Negative Messages</h3>
    </div>

    <div style="padding: 0.5vw"></div>
    <div class="jumbotron">
        <div id="quoteCarousel" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                {% for i in curMessages %}
                    {% if forloop.counter == 1 %}
                        <div class="carousel-item active">
                            <div class="text-center">
                                <p class="h4">
                                    {{ i | safe }}
                                </p>

                            </div>
                        </div>
                    {% else %}
                        <div class="carousel-item">
                            <div class="text-center">
                                <p class="h4">
                                    {{ i | safe }}
                                </p>

                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            <a class="carousel-control-prev" href="#quoteCarousel" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#quoteCarousel" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>

    <div class="bg-white border-bottom shadow-sm " style=" box-shadow: 0 4px 2px -2px gray;">
        <h3 class="my-0 mr-md-auto font-weight-bold">&nbsp;&nbsp;&nbsp;&nbsp;How You Can Help</h3>
        <p class="lead">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Upload your own Starcraft replays to expand our database of
            messages</p>
    </div>


    <div id="formHolder" class="jumbotron"
         style="display: flex;flex-direction: column;align-items: center;justify-content: center;">
        <form id="uploadForm" action='{% url "replay-upload" %}' method='post' enctype="multipart/form-data">
            {% csrf_token %}
            <div id="fileDiv" class="form-group font-weight-bold h5">
                {{ form.replay_file | as_crispy_field }}
                <!--<label class="custom-file-label" for="customFile">Choose Replay File...</label>-->
            </div>
            <input id="submitButton" type="submit" class="btn btn-outline-primary" value="Upload">
        </form>


    </div>

    <div class="ButtonDiv" style="padding-top: 1vw">
        &nbsp;&nbsp;
        <form id="clickTest" method="post" action=".">{% csrf_token %}
            <input type="submit" class="btn btn-outline-primary" value="Click" name="process_btn">
        </form>
    </div>
    <button id="helloButton">hi</button>
    <script type="text/javascript">
        $("#helloButton").click(function (e) {
            console.log("button pressed")
            var terranIcon = document.getElementById('terranIcon');
            terranIcon.className = 'hvr-grow-card-red';
            terranIcon.style.animationPlayState = "running";
            terranIcon.style.animation = 'none';
            terranIcon.offsetHeight;
            terranIcon.style.animation = null;

            var terranUpArrow = document.getElementById('terranUpArrow');
            terranUpArrow.style.visibility = "visible";
            terranUpArrow.style.animationPlayState = "running";
            terranUpArrow.style.animation = 'none';
            terranUpArrow.offsetHeight;
            terranUpArrow.style.animation = null;

        });
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            var startTerran = {{ terran }};
            var startZerg = {{ zerg }};
            var startProtoss = {{ protoss }};

            if (startTerran <= startZerg && startTerran <= startProtoss) {
                document.getElementById("terranSalt").style.visibility = "visible";
            }

            if (startZerg <= startTerran && startZerg <= startProtoss) {
                document.getElementById("zergSalt").style.visibility = "visible";
            }

            if (startProtoss <= startTerran && startProtoss <= startZerg) {
                document.getElementById("protossSalt").style.visibility = "visible";
            }


        });
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            setInterval(refreshSent, 3000);
        });

        function refreshSent() {
            var curTerran = parseFloat($('#terranSent').text());
            var curZerg = parseFloat($('#zergSent').text());
            var curProtoss = parseFloat($('#protossSent').text());
            $.ajax({
                url: {% url 'sentiment-data' %},
                success: function (data) {
                    var newTerran = parseFloat(data['terran']);
                    var terranIcon = document.getElementById('terranIcon');

                    if (newTerran > curTerran) {
                        terranIcon.className = 'hvr-grow-card-green';
                        terranIcon.style.animationPlayState = "running";
                        terranIcon.style.animation = 'none';
                        terranIcon.offsetHeight;
                        terranIcon.style.animation = null;
                        var terranUpArrow = document.getElementById('terranUpArrow');
                        terranUpArrow.style.visibility = "visible";
                        terranUpArrow.style.animationPlayState = "running";
                        terranUpArrow.style.animation = 'none';
                        terranUpArrow.offsetHeight;
                        terranUpArrow.style.animation = null;
                    } else if (newTerran < curTerran) {
                        terranIcon.className = 'hvr-grow-card-red';
                        terranIcon.style.animationPlayState = "running";
                        terranIcon.style.animation = 'none';
                        terranIcon.offsetHeight;
                        terranIcon.style.animation = null;
                        var terranDownArrow = document.getElementById('terranDownArrow');
                        terranDownArrow.style.visibility = "visible";
                        terranDownArrow.style.animationPlayState = "running";
                        terranDownArrow.style.animation = 'none';
                        terranDownArrow.offsetHeight;
                        terranDownArrow.style.animation = null;
                    }

                    var newZerg = parseFloat(data['zerg']);
                    var zergIcon = document.getElementById('zergIcon');

                    if (newZerg > curZerg) {
                        zergIcon.className = 'hvr-grow-card-green';
                        zergIcon.style.animationPlayState = "running";
                        zergIcon.style.animation = 'none';
                        zergIcon.offsetHeight;
                        zergIcon.style.animation = null;
                        var zergUpArrow = document.getElementById('zergUpArrow');
                        zergUpArrow.style.visibility = "visible";
                        zergUpArrow.style.animationPlayState = "running";
                        zergUpArrow.style.animation = 'none';
                        zergUpArrow.offsetHeight;
                        zergUpArrow.style.animation = null;
                    } else if (newZerg < curZerg) {
                        zergIcon.className = 'hvr-grow-card-red';
                        zergIcon.style.animationPlayState = "running";
                        zergIcon.style.animation = 'none';
                        zergIcon.offsetHeight;
                        zergIcon.style.animation = null;
                        var zergDownArrow = document.getElementById('zergDownArrow');
                        zergDownArrow.style.visibility = "visible";
                        zergDownArrow.style.animationPlayState = "running";
                        zergDownArrow.style.animation = 'none';
                        zergDownArrow.offsetHeight;
                        zergDownArrow.style.animation = null;
                    }

                    var newProtoss = parseFloat(data['protoss']);
                    var protossIcon = document.getElementById('protossIcon');

                    if (newProtoss > curProtoss) {
                        protossIcon.className = 'hvr-grow-card-green';
                        protossIcon.style.animationPlayState = "running";
                        protossIcon.style.animation = 'none';
                        protossIcon.offsetHeight;
                        protossIcon.style.animation = null;
                        var protossUpArrow = document.getElementById('protossUpArrow');
                        protossUpArrow.style.visibility = "visible";
                        protossUpArrow.style.animationPlayState = "running";
                        protossUpArrow.style.animation = 'none';
                        protossUpArrow.offsetHeight;
                        protossUpArrow.style.animation = null;
                    } else if (newProtoss < curProtoss) {
                        protossIcon.className = 'hvr-grow-card-red';
                        protossIcon.style.animationPlayState = "running";
                        protossIcon.style.animation = 'none';
                        protossIcon.offsetHeight;
                        protossIcon.style.animation = null;
                        var protossDownArrow = document.getElementById('protossDownArrow');
                        protossDownArrow.style.visibility = "visible";
                        protossDownArrow.style.animationPlayState = "running";
                        protossDownArrow.style.animation = 'none';
                        protossDownArrow.offsetHeight;
                        protossDownArrow.style.animation = null;
                    }
                    document.getElementById("terranSalt").style.visibility = "hidden";
                    document.getElementById("zergSalt").style.visibility = "hidden";
                    document.getElementById("protossSalt").style.visibility = "hidden";

                    if (newTerran <= newZerg && newTerran <= newProtoss) {
                        document.getElementById("terranSalt").style.visibility = "visible";
                    }

                    if (newZerg <= newTerran && newZerg <= newProtoss) {
                        document.getElementById("zergSalt").style.visibility = "visible";
                    }

                    if (newProtoss <= newTerran && newProtoss <= newZerg) {
                        document.getElementById("protossSalt").style.visibility = "visible";
                    }

                    $('#terranSent').html(data['terran']);
                    $('#zergSent').html(data['zerg']);
                    $('#protossSent').html(data['protoss']);
                }
            });
        }
    </script>




    <!--<script type="text/javascript">
        $('#uploadForm').submit(function (e) {
            e.preventDefault();
            var serializedData = $("#uploadForm").serialize()
            $.ajax({
                headers: {'X-CSRFToken': {{csrf_token}}},
                type: 'POST',
                url: '{% url "replay-upload" %}',
                data: serializedData,
                contentType: 'multipart/form-data',
                dataType: 'json',
                success: function (data) {
                    alert("You Did It")
                    $("#dangerAlert").style.visibility = "hidden";
                    $("#successAlert").style.visibility = "visible";
                },
                error: function (data) {
                    console.log("Failed: " + data)
                    $("#successAlert").style.visibility = "hidden";
                    $("#dangerAlert").style.visibility = "visible";
                },
            });
            return false
        });
    </script>-->
{% endblock %}
